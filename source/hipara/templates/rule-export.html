{% extends "base.html" %}
{% load staticfiles %}
{% block title %}Rule Extract{% endblock %}

{% block head %}
<link rel="stylesheet" href="{% static 'plugins/datatables/dataTables.bootstrap.css' %}">
{% endblock %}

{% block content %}
<div class="content-wrapper">
    <div class="container padding-lr-zero">
        <section class="content-header">
            <h1>
                Rule
            </h1>
            <ol class="breadcrumb">
                <li><a href="/"><i class="fa fa-dashboard"></i> Home</a></li>
                <li>Rules</li>
                <li>Extract</li>
            </ol>
        </section>

        <section class="content">
            <div class="row">
                <div class="col-xs-12">
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <h3 class="box-title">Search rules</h3>
                        </div>
                        <form role="form" action="/export/" method="GET" id="rule-search">
                            <div class="box-body">
                                <div class="form-group col-lg-6 col-md-6">
                                    <label for="title">Name | Title</label>
                                    <input type="text" class="form-control" id="title" placeholder="Enter title" autofocus="" name="title" value="{{ title }}">
                                </div>
                                <div class="form-group col-lg-6 col-md-6">
                                    <label for="category">Category</label>
                                    <div class="form-group">
                                        <select name="category" class="form-control" id="category">
                                            <option value="0">Select</option>
                                            {% for cat in categories %}
                                                <option value="{{ cat.category_id }}" {% if cat.category_id == category %} selected {% endif %}>{{ cat.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group col-lg-6 col-md-6" id="rule-search-error" style="display:none;"><b>Provide atleast one field for search.</b></div>
                                <div class="form-group col-lg-12 col-md-12 col-sm-12">
                                    <button type="submit" class="btn btn-primary">Search Results</button>
                                    <button type="button" class="btn btn-primary">Clear Results</button>
                                </div>
                            </div>
                            <!-- /.box-body -->
                        </form>
                    </div>
                    <!-- /.box-header -->
                    <div class="box box-primary">
                        <div class="box-header with-border">
                            <h3 class="box-title">Rules</h3>

                            <form role="form" method="GET" id="export-rule" >
                                <div class="pull-right col-lg-6">
                                <div class="form-group col-lg-9 col-md-9">
                                    <label for="extract_category">Category</label>
                                    <div class="form-group">
                                        <select name="category" class="form-control" id="extract_category">
                                            <option value="select">Select</option>
                                            <option value="0">All</option>
                                            {% for cat in categories %}
                                            <!--cat.rule_category.all|length-->
                                                <option value="{{ cat.category_id }}" {% if cat.category_id == category %} selected {% endif %}>{{ cat.name }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group col-lg-6 col-md-6" id="rule-search-error" style="display:none;"><b>Provide atleast one field for search.</b></div>
                                <div class="form-group col-lg-3 col-md-3" style="margin-top:1.8em;">
                                    <button type="button" class="btn btn-primary">Extract All Rules</button>
                                </div>
                                    </div>
                            </form>

                        </div>
                        <div class="box-body">
                            <table id="example1" class="table table-bordered table-hover">
                                <thead>
                                <tr>
                                    <th>Id</th>
                                    <th>Rule</th>
                                    <th>Category</th>
                                    <th>Source</th>
                                    <th>Version</th>
                                    <th>State</th>
                                    <th>Extract</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for rule in rules %}
                                <tr>
                                    <td>{{ forloop.counter|add:first_rule|add:-1 }}</td>
                                    <td>{{rule.name}}</td>
                                    <td>{{rule.category}}</td>
                                    <td>{{rule.source}}</td>
                                    <td>{{rule.version}}</td>
                                    <td>
                                        {% if rule.status == None %} Pending approval
                                        {% elif rule.status == True %} Deployed
                                        {% elif rule.status == False %} Not deployed
                                        {% endif %}
                                    </td>
                                    <td><a href="/export/rule/{{rule.rule_id}}/"><i class="glyphicon glyphicon-download"></i></a></td>
                                </tr>
                                {% endfor %}
                                </tbody>
                                <tfoot>
                                <tr>
                                    <th>Id</th>
                                    <th>Rule</th>
                                    <th>Category</th>
                                    <th>Source</th>
                                    <th>Version</th>
                                    <th>State</th>
                                    <th>Extract</th>
                                </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                    <!-- /.box-body -->
                </div>
                <!-- /.box -->
            </div>
            <!-- /.col -->
        </section>
    </div>
</div>

{% endblock %}


{% block footer %}
<script src="{% static 'dist/js/validator.min.js' %}"></script>
<script>
    $('#rule-search').validator().on('submit', function (e) {
        var formdata = $('#rule-search').serializeArray();
        if($( "#title" ).val() == "" && $( "#category" ).val() == "0"){
            $('#rule-search-error').css('display','block');
            return false;
        }else{
            $('#rule-search-error').css('display','none');
        }
    });

    $('#export-rule').validator().on('submit', function (e) {
        var formdata = $('#rule-search').serializeArray();
        // everything looks good!
        console.log($( "#extract_category" ).val());
        if($( "#extract_category" ).val() == "select"){
            $('#export-rule-error').css('display','block');
            return false;
        }else{
            $('#export-rule-error').css('display','none');
        }
    });
</script>
{% endblock %}
